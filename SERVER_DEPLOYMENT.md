# Инструкция по развертыванию исправления на сервере

## Проблема
Бот показывает неправильное время выполнения привычек (UTC вместо московского времени).

## Решение
Исправлена функция `format_date` для корректной конвертации UTC времени в московское время.

## Шаги для развертывания на сервере

### 1. Подключение к серверу
```bash
ssh root@89.223.124.191
```

### 2. Переход в директорию проекта
```bash
cd /path/to/habit_cracker_bot
```

### 3. Обновление кода из репозитория
```bash
git fetch origin
git checkout dev
git pull origin dev
```

### 4. Установка зависимостей
```bash
pip3 install -r requirements.txt
```

### 5. Проверка исправления
```bash
python3 server_test.py
```

Ожидаемый результат:
```
✅ pytz импортирован успешно
✅ format_date импортирована успешно
Тест: 2025-06-29 09:25:00 -> 29 июня в 12:25
Ожидалось: 29 июня в 12:25
✅ ИСПРАВЛЕНИЕ РАБОТАЕТ КОРРЕКТНО!
```

### 6. Перезапуск бота
```bash
# Остановить текущий процесс бота
pkill -f main.py

# Запустить бота заново
nohup python3 main.py > bot.log 2>&1 &
```

### 7. Проверка работы бота
```bash
tail -f bot.log
```

## Возможные проблемы

### Проблема: "ModuleNotFoundError: No module named 'pytz'"
**Решение:**
```bash
pip3 install pytz==2024.1
```

### Проблема: Бот все еще показывает неправильное время
**Возможные причины:**
1. Бот не перезапустился с новым кодом
2. Кэш Python не обновился
3. Используется старая версия кода

**Решение:**
```bash
# Принудительная перезагрузка
pkill -f main.py
sleep 2
nohup python3 main.py > bot.log 2>&1 &
```

### Проблема: Git показывает конфликты
**Решение:**
```bash
git stash
git pull origin dev
git stash pop
```

## Проверка результата
После развертывания выполните в боте:
1. Выберите "Выполнить привычку"
2. Выберите любую привычку
3. Введите количество выполнений
4. Подтвердите

Время должно отображаться корректно (московское время, а не UTC).

## Откат изменений (если что-то пошло не так)
```bash
git checkout main
git pull origin main
pkill -f main.py
nohup python3 main.py > bot.log 2>&1 &
``` 